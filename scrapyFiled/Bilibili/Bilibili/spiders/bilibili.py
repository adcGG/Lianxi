# -*- coding: utf-8 -*-
import scrapy
import json
from Bilibili.items import BilibiliItem
class BilibiliSpider(scrapy.Spider):
    name = 'bilibili'
    allowed_domains = ['app.bilibili.com']
    # start_urls = ['http://app.bilibili.com/']
    baseurl ='https://app.bilibili.com/x/v2/feed/index?ad_extra=2F160688A991F9E874393027277D85422F5D26B73238F495719706F7F69C8485FF36E2FDEDDDDA0C080EB4FEFCE5AEC82C9AFC0569F4FCF3DD3E33EC93D7E653857B7E4DEAD038A38A1042A0ED26DA723A0D0BA60C241B4B54420DA0BE2E10BD3A948E2B5F44657D491C165F1FFD9BF24C7914418063E8B8B713592526A49376055C964BA80A28D46FF88D87AB0F5FE2C3E4576D02086EA1F327FE38DDC1EB8650A8E30FD203A66D217191413C40F3D6313F82BAC30DA18FA10925CFF98F8504D52E7764D326958134A8B5270E06518355AA427AFDA3C10F6F42E5D65D1547C59018A5E54FDD7EB04B36E5BBB22ABC7DEB1A4D97BDB3A75DAA2E15C35EFCC3073B3BBADC65A3C1DB910ECEA96033B62289966A87C934626F0FD4719724D4F002B05CECCC3F1A62A4CFD2E8F98D6D7A94E9757EFB775A5B8419E31BEBB1685CC83E8F6BFDE1EA2626C0A49A5E284D1032B83BE8945161F834A36169B8674D0A5F8A932C3470A0898E42B0E91F9EE8CC5E904429FC0F3B890A4205A6150B9D4A1539B9CF8183B1A3086E4A562A97300FD4CC1932B46609D98991AF7895DB0D2C77F2BD7E9D9271FAF14E6E8DF859A5B4F2C658AD8C619933F20251603AB339B0A7FF72A4E345CEC2E53BE217F46C8C3F5F10D8E78A0B27A485C15ECE65E438F0A4EA1429A3635EA04E9C44994212486E019B35208E84F06AF310170F5B6B462BBE1454EA520D4A00506AC08B5BC36FC528F804BB64123FCF0CC1382AD77ED35896939335A2F0DD1AB395B9F2DC027B80B3B1AB40233EAB4B04F1DE16A8B7EF607CE829F8D96D6FF5EF2216D55A81C45812817050E504A3E8EB1862E44A7D72CF1CCAD0FDFE71CC295F306869BC0B6E75AE&appkey=1d8b6e7d45233436&autoplay_card=0&build=5452100&channel=baidu&column=2&device_name=MI%202A&device_type=0&flush=0&fnval=16&fnver=0&force_host=0&fourk=0&idx=0&login_event=1&mobi_app=android&network=wifi&open_event=cold&platform=android&pull=true&qn=32&recsys_mode=0&statistics=%7B%22abtest%22%3A%22%22%2C%22platform%22%3A3%2C%22version%22%3A%225.45.2%22%2C%22appId%22%3A1%7D&ts=15653103'

    start_urls = ['https://app.bilibili.com/x/v2/feed/index?ad_extra=2F160688A991F9E874393027277D85422F5D26B73238F495719706F7F69C8485FF36E2FDEDDDDA0C080EB4FEFCE5AEC82C9AFC0569F4FCF3DD3E33EC93D7E653857B7E4DEAD038A38A1042A0ED26DA723A0D0BA60C241B4B54420DA0BE2E10BD3A948E2B5F44657D491C165F1FFD9BF24C7914418063E8B8B713592526A49376055C964BA80A28D46FF88D87AB0F5FE2C3E4576D02086EA1F327FE38DDC1EB8650A8E30FD203A66D217191413C40F3D6313F82BAC30DA18FA10925CFF98F8504D52E7764D326958134A8B5270E06518355AA427AFDA3C10F6F42E5D65D1547C59018A5E54FDD7EB04B36E5BBB22ABC7DEB1A4D97BDB3A75DAA2E15C35EFCC3073B3BBADC65A3C1DB910ECEA96033B62289966A87C934626F0FD4719724D4F002B05CECCC3F1A62A4CFD2E8F98D6D7A94E9757EFB775A5B8419E31BEBB1685CC83E8F6BFDE1EA2626C0A49A5E284D1032B83BE8945161F834A36169B8674D0A5F8A932C3470A0898E42B0E91F9EE8CC5E904429FC0F3B890A4205A6150B9D4A1539B9CF8183B1A3086E4A562A97300FD4CC1932B46609D98991AF7895DB0D2C77F2BD7E9D9271FAF14E6E8DF859A5B4F2C658AD8C619933F20251603AB339B0A7FF72A4E345CEC2E53BE217F46C8C3F5F10D8E78A0B27A485C15ECE65E438F0A4EA1429A3635EA04E9C44994212486E019B35208E84F06AF310170F5B6B462BBE1454EA520D4A00506AC08B5BC36FC528F804BB64123FCF0CC1382AD77ED35896939335A2F0DD1AB395B9F2DC027B80B3B1AB40233EAB4B04F1DE16A8B7EF607CE829F8D96D6FF5EF2216D55A81C45812817050E504A3E8EB1862E44A7D72CF1CCAD0FDFE71CC295F306869BC0B6E75AE&appkey=1d8b6e7d45233436&autoplay_card=0&build=5452100&channel=baidu&column=2&device_name=MI%202A&device_type=0&flush=0&fnval=16&fnver=0&force_host=0&fourk=0&idx=0&login_event=1&mobi_app=android&network=wifi&open_event=cold&platform=android&pull=true&qn=32&recsys_mode=0&statistics=%7B%22abtest%22%3A%22%22%2C%22platform%22%3A3%2C%22version%22%3A%225.45.2%22%2C%22appId%22%3A1%7D&ts=1565310374&sign=6998923c0eb6fabc515baa6e4f8d4d9f%20']
    def parse(self, response):
        Info_list = json.loads(response.text)["data"]["items"]

        for i in Info_list:
            if i["card_goto"] == "av":
                item = BilibiliItem()
                item["param"] = i["param"]
                item["cover"] = i["cover"]
                item["title"] = i["title"]
                item["cover_left_text_1"] = i["cover_left_text_1"]
                item["cover_left_text_2"] = i["cover_left_text_2"]
                item["up_name"] = i["args"]["up_name"]
                try:
                    item["rname"] = i["args"]["rname"]
                except:
                    item["rname"] = ''
                try:
                    item["tname"] = i["args"]["tname"]
                except:
                    item["tname"] = ''
                yield item
            else:
                print("广告"*50)

        j = 75
        if j<85:
            print("新的URL"*30)
            urllast= str(j) + '&sign=6998923c0eb6fabc515baa6e4f8d4d9f%20'
            j += 1
            yield scrapy.Request(self.baseurl+urllast,callback=self.parse,dont_filter=True)



